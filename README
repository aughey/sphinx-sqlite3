Thanks to Andrew Aksyonoff for providing the initial patch.
